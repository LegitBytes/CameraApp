(()=>{"use strict";var e={841:(e,s,r)=>{r.d(s,{OG:()=>t,O8:()=>a,mt:()=>u,nS:()=>i});const t=e=>({statusCode:200,body:JSON.stringify(e),headers:{"Access-Control-Allow-Origin":"*"}}),a=e=>({statusCode:201,body:JSON.stringify(e),headers:{"Access-Control-Allow-Origin":"*"}}),u=e=>({statusCode:400,body:JSON.stringify(e),headers:{"Access-Control-Allow-Origin":"*"}}),i=e=>({statusCode:500,body:JSON.stringify(e),headers:{"Access-Control-Allow-Origin":"*"}})},360:(e,s,r)=>{r.d(s,{Z:()=>t});const t={INTEGRATOR_SAVE:"Integrator Saved Successfully.",INTEGRATOR_UPDATE:"Integrator Updated Successfully.",INTEGRATOR_DELETE:"Integrator Deleted Successfully.",INTEGRATOR_NOT_FOUND:"Integrator not found with the given ID.",INTEGRATOR_PATHPARAMETERS_ERROR:"Please provide Integrator ID.",GROUP_SAVE:"Group Saved Successfully.",GROUP_UPDATE:"Group Updated Successfully.",GROUP_DELETE:"Group Deleted Successfully.",GROUP_NOT_FOUND:"Group not found with the given ID.",GROUP_PATHPARAMETERS_ERROR:"Please provide Group ID.",GROUP_ID_NOT_PROVIDED_ERROR:"Please provide Group IDs.",SITE_SAVE:"Site Saved Successfully.",SITE_UPDATE:"Site Updated Successfully.",SITE_DELETE:"Site Deleted Successfully.",SITE_NOT_FOUND:"Site not found with the given ID.",SITE_PATHPARAMETERS_ERROR:"Please provide Site ID.",SITE_ID_NOT_PROVIDED_ERROR:"Please provide Site IDs.",USER_SAVE:"User Saved Successfully.",USER_UPDATE:"User Updated Successfully.",USER_DELETE:"User Deleted Successfully.",USER_NOT_FOUND:"User not found with the given ID.",USER_PATHPARAMETERS_ERROR:"Please provide User ID.",USER_ID_NOT_PROVIDED_ERROR:"Please provide User IDs.",CUSTOMER_SAVE:"Customer Saved Successfully.",CUSTOMER_UPDATE:"Customer Updated Successfully.",CUSTOMER_DELETE:"Customer Deleted Successfully.",CUSTOMER_NOT_FOUND:"Customer not found with the given ID.",CUSTOMER_PATHPARAMETERS_ERROR:"Please provide Customer ID.",CUSTOMER_ID_NOT_PROVIDED_ERROR:"Please provide Customer IDs.",CAMERA_SAVE:"Camera Saved Successfully.",CAMERA_UPDATE:"Camera Updated Successfully.",CAMERA_DELETE:"Camera Deleted Successfully.",CAMERA_NOT_FOUND:"Camera not found with the given ID.",CAMERA_PATHPARAMETERS_ERROR:"Please provide Camera ID.",CAMERA_ID_NOT_PROVIDED_ERROR:"Please provide Camera IDs.",SERVER_ERROR:"Internal Server Error occured."}},663:(e,s,r)=>{r.d(s,{z:()=>c});var t=r(806),a=r.n(t),u=r(657),i=r.n(u);const c=e=>a()(e).use(i()())},806:e=>{e.exports=require("@middy/core")},657:e=>{e.exports=require("@middy/http-json-body-parser")},212:e=>{e.exports=require("@prisma/client")}},s={};function r(t){var a=s[t];if(void 0!==a)return a.exports;var u=s[t]={exports:{}};return e[t](u,u.exports,r),u.exports}r.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return r.d(s,{a:s}),s},r.d=(e,s)=>{for(var t in s)r.o(s,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},r.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};(()=>{r.r(t),r.d(t,{addUser:()=>i,getUserById:()=>c,getAllUsers:()=>o,editUser:()=>n,deleteUser:()=>R});var e=r(841),s=r(663),a=r(360);const u=new(r(212).PrismaClient),i=(0,s.z)((async s=>{try{const{user_email:r,group_id:t,site_ids:i,customer_ids:c,camera_ids:o,integrator_id:n}=s.body;if(!i)return(0,e.mt)({message:a.Z.SITE_ID_NOT_PROVIDED_ERROR});if(!c)return(0,e.mt)({message:a.Z.CUSTOMER_ID_NOT_PROVIDED_ERROR});if(!o)return(0,e.mt)({message:a.Z.CAMERA_ID_NOT_PROVIDED_ERROR});const R=i.map((async e=>await u.sites.findUnique({where:{site_id:e}}))),_=c.map((async e=>await u.customers.findUnique({where:{customer_id:e}}))),d=o.map((async e=>await u.cameras.findUnique({where:{camera_id:e}}))),E=await u.users.create({data:{groups:{connect:{group_id:t}},integrators:{connect:{integrator_id:n}},user_email:r,customers:{create:_},sites:{create:R},cameras:{create:d}},include:{customers:!0,sites:!0,cameras:!0}});return(0,e.O8)({message:a.Z.USER_SAVE,user:E})}catch(s){return console.error(s),(0,e.nS)({message:a.Z.SERVER_ERROR,error:s})}})),c=(0,s.z)((async s=>{if(!s.pathParameters||!s.pathParameters.userId)return(0,e.mt)({message:a.Z.USER_PATHPARAMETERS_ERROR});const r=s.pathParameters.userId;try{const s=await u.users.findUnique({where:{user_id:r},select:{user_id:!0,user_email:!0,is_disabled:!0,createdAt:!0,updatedAt:!0,groups:!0,integrators:!0,cameras:!0,customers:!0,sites:!0}}),t=await u.$queryRaw(`SELECT c.camera_id\n      FROM  "_camerasTousers" cu\n      JOIN  cameras c ON cu."A" = c.camera_id\n      JOIN  users u ON cu."B" = u.user_id\n      WHERE u.user_id::text = '${r}'\n      GROUP BY c.camera_id;`),a=await u.$queryRaw(`SELECT c.customer_id\n      FROM  "_customersTousers" cu\n      JOIN  customers c ON cu."A" = c.customer_id\n      JOIN  users u ON cu."B" = u.user_id\n      WHERE u.user_id::text = '${r}'\n      GROUP BY c.customer_id;`),i=await u.$queryRaw(`SELECT s.site_id\n      FROM  "_sitesTousers" su\n      JOIN  sites s ON su."A" = s.site_id\n      JOIN  users u ON su."B" = u.user_id\n      WHERE u.user_id::text = '${r}'\n      GROUP BY s.site_id;`),c=t.length,o=a.length,n=i.length;return(0,e.OG)({user:{...s,camera_count:c,customer_count:o,site_count:n}})}catch(s){return console.error(s),(0,e.nS)({message:a.Z.SERVER_ERROR,error:s})}})),o=(0,s.z)((async()=>{const s=await u.users.findMany({select:{user_id:!0,user_email:!0,is_disabled:!0,createdAt:!0,updatedAt:!0,groups:!0,integrators:!0,cameras:!0,customers:!0,sites:!0}}),r=await Promise.all(s.map((async e=>{const s=e.user_id,r=await u.$queryRaw(`SELECT c.camera_id\n      FROM  "_camerasTousers" cu\n      JOIN  cameras c ON cu."A" = c.camera_id\n      JOIN  users u ON cu."B" = u.user_id\n      WHERE u.user_id::text = '${s}'\n      GROUP BY c.camera_id;`),t=await u.$queryRaw(`SELECT c.customer_id\n      FROM  "_customersTousers" cu\n      JOIN  customers c ON cu."A" = c.customer_id\n      JOIN  users u ON cu."B" = u.user_id\n      WHERE u.user_id::text = '${s}'\n      GROUP BY c.customer_id;`),a=await u.$queryRaw(`SELECT s.site_id\n      FROM  "_sitesTousers" su\n      JOIN  sites s ON su."A" = s.site_id\n      JOIN  users u ON su."B" = u.user_id\n      WHERE u.user_id::text = '${s}'\n      GROUP BY s.site_id;`),i=r.length,c=t.length,o=a.length;return{...e,camera_count:i,customer_count:c,site_count:o}})));return(0,e.OG)({users:r})})),n=(0,s.z)((async s=>{if(!s.pathParameters||!s.pathParameters.userId)return(0,e.mt)({message:a.Z.USER_PATHPARAMETERS_ERROR});const r={...s.body},t=s.pathParameters.userId;try{return await u.users.update({where:{user_id:t},data:r}),(0,e.OG)({message:a.Z.USER_UPDATE})}catch(s){return console.error(s),(0,e.nS)({message:a.Z.SERVER_ERROR,error:s})}})),R=(0,s.z)((async s=>{if(!s.pathParameters||!s.pathParameters.userId)return(0,e.mt)({message:a.Z.USER_PATHPARAMETERS_ERROR});const r=s.pathParameters.userId;try{return await u.users.delete({where:{user_id:r}}),(0,e.OG)({message:a.Z.USER_DELETE})}catch(s){return console.error(s),(0,e.nS)({message:a.Z.SERVER_ERROR,error:s})}}))})();var a=exports;for(var u in t)a[u]=t[u];t.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();
//# sourceMappingURL=handler.js.map